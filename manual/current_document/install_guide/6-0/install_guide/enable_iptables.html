<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <!-- Always force latest IE rendering engine or request Chrome Frame -->
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

  
  <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,300italic,400italic,400,600' rel='stylesheet' type='text/css'>
  <!-- Use title if it's in the page YAML frontmatter -->
  <title>
      Enabling iptables (Optional) |
    inHybrid Database Docs
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="../../stylesheets/all.css" rel="stylesheet" media="screen, print" />
  <link href="../../stylesheets/print.css" rel="stylesheet" media="print" />
  <link href='../../images/favicon.ico' rel='shortcut icon'>

  <script src="../../javascripts/all.js"></script>
  
</head>

<body class="x6-4 x6-4_install_guide x6-4_install_guide_enable_iptables has-subnav">

<div class="viewport">
  <div class='wrap'>
    <script type="text/javascript">

    </script>

     
  <header class="header header-layout">
    <h1 class="logo">
      <a href="../../index.html">inHybrid Database Documentation</a>
    </h1>
    
    <div class="header-links js-bar-links">
      <div class="btn-menu" data-behavior="MenuMobile"></div>
      <div class="header-item"><a href="https://greenplum.org">Back to inHybrid Database</a></div>
      <div class="header-item">
        <a href="https://github.com/greenplum-db/hdb/wiki">Wiki</a>
      </div>
      
    </div>
  </header>


    <div class="container">

      <!--googleoff: index-->
      <div id="sub-nav" class="nav-container js-sidenav" role="navigation" >
  <a class="sidenav-title" data-behavior="SubMenuMobile">
    Doc Index
  </a>
  <div class="nav-content">
    
  <ul>
    
      <li class="">
        <a href="../homenav.html">inspur inHybrid 6.4 Documentation</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="install_guide.html">Installation Guide</a>
        
  <ul>
    
      <li class="">
        <a href="platform-requirements.html">Platform Requirements</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="preinstall_concepts.html">Introduction to inHybrid</a>
        
  <ul>
    
      <li class="">
        <a href="preinstall_concepts.html#topic2">The inHybrid Master</a>
        

      </li>
    
      <li class="">
        <a href="preinstall_concepts.html#topic4">The Segments</a>
        

      </li>
    
      <li class="">
        <a href="preinstall_concepts.html#topic9">The Interconnect</a>
        

      </li>
    
      <li class="">
        <a href="preinstall_concepts.html#topic13">ETL Hosts for Data Loading</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="has_submenu">
        <a href="capacity_planning.html">Estimating Storage Capacity</a>
        
  <ul>
    
      <li class="">
        <a href="capacity_planning.html#topic2">Calculating Usable Disk Capacity</a>
        

      </li>
    
      <li class="">
        <a href="capacity_planning.html#topic3">Calculating User Data Size</a>
        

      </li>
    
      <li class="">
        <a href="capacity_planning.html#topic4">Calculating Space Requirements for Metadata and Logs</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="prep_os.html">Configuring Your Systems</a>
        

      </li>
    
      <li class="">
        <a href="install_hdb.html">Installing the inHybrid Database Software</a>
        

      </li>
    
      <li class="">
        <a href="create_data_dirs.html">Creating the Data Storage Areas</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="validate.html">Validating Your Systems</a>
        
  <ul>
    
      <li class="">
        <a href="validate.html#topic4">Validating Network Performance</a>
        

      </li>
    
      <li class="">
        <a href="validate.html#topic5">Validating Disk I&#x2F;O and Memory Bandwidth</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="init_hdb.html">Initializing a inHybrid Database System</a>
        

      </li>
    
      <li class="">
        <a href="install_modules.html">Installing Additional Supplied Modules</a>
        

      </li>
    
      <li class="">
        <a href="localization.html">Configuring Timezone and Localization Settings</a>
        

      </li>
    
      <li class="">
        <a href="upgrading.html">Upgrading from an Earlier inHybrid 6 Release</a>
        

      </li>
    
      <li class="">
        <a href="migrate.html">Migrating Data from inHybrid 4.3 or 5</a>
        

      </li>
    
      <li class="">
        <a href="enable_iptables.html">Enabling iptables (Optional)</a>
        

      </li>
    
      <li class="">
        <a href="apx_mgmt_utils.html">Installation Management Utilities</a>
        

      </li>
    
      <li class="has_submenu">
        <a href="env_var_ref.html">inHybrid Environment Variables</a>
        
  <ul>
    
      <li class="">
        <a href="env_var_ref.html#topic2">Required Environment Variables</a>
        

      </li>
    
      <li class="">
        <a href="env_var_ref.html#topic7">Optional Environment Variables</a>
        

      </li>
    
  </ul>


      </li>
    
      <li class="">
        <a href="ansible-example.html">Example Ansible Playbook</a>
        

      </li>
    
  </ul>


      </li>
    
  </ul>


  </div>
</div>

      <!--googleon: index-->

      <main class="content content-layout" id="js-content" role="main">
        <a id="top"></a>
        
          <h1 class="title-container" style="display: none;">
    Enabling iptables (Optional)
  </h1>

          <div id="js-quick-links" >
            
          </div>
        <div class="to-top" id="js-to-top">
          <a href="enable_iptables.html#top" title="back to top"></a>
        </div>
        

  <h1 class="title topictitle1">启用iptables(可选)</h1>

  
  <div class="body">
<p class="shortdesc">在Linux系统上，可以配置并启用iptables防火墙来处理inHybrid数据库。</p>

    <div class="note note">
注意:启用iptables时，inHybrid数据库性能可能会受到影响。您应该在启用iptables的情况下测试应用程序的性能，以确保性能是可接受的。</div>

    <p class="p">有关iptables的更多信息，请参见操作系统的iptables和防火墙文档。请参见禁用SELinux和防火墙软件。</p>

    <div class="section" id="topic1__ji163124">
<h2 class="title sectiontitle">如何启用iptables</h2>
      
      <ol class="ol" id="topic1__ol_akk_knz_thb">
        <li class="li" id="topic1__ji163128">作为hdbadmin，在inHybrid数据库master主机上运行这个命令来停止inHybrid数据库:<pre class="pre codeblock">$ hdbstop -a</pre>
</li>

        <li class="li" id="topic1__ji163139">在inHybrid 数据库主机上:<ol class="ol" type="a" id="topic1__ol_bkk_knz_thb">
            <li class="li" id="topic1__ji163142">基于示例iptables规则更新文件/etc/sysconfig/iptables。</li>

            <li class="li" id="topic1__ji163144">作为root用户，运行以下命令启用iptables:<pre class="pre codeblock"># chkconfig iptables on
# service iptables start</pre>
</li>

          </ol>
</li>

        <li class="li" id="topic1__ji163149">作为hdbadmin，在inHybrid数据库主机上运行这个命令，启动inHybrid数据库:<pre class="pre codeblock">$ hdbstart -a</pre>
</li>

      </ol>

      <div class="note warning">
<span class="warningtitle">警告:启用iptables之后，/var/log/messages文件中的这个错误表明iptables表的设置太低，需要增加。<pre class="pre codeblock">ip_conntrack: table full, dropping packet.</pre>
<p class="p">作为根用户，运行此命令查看iptables表值:</p>
<pre class="pre codeblock"># sysctl net.ipv4.netfilter.ip_conntrack_max</pre>
<p class="p">为了确保inHybrid数据库工作负载不会以根用户身份溢出iptables表，将其设置为以下值:
          </p>
<pre class="pre codeblock"># sysctl net.ipv4.netfilter.ip_conntrack_max=6553600</pre>
<p class="p">该值可能需要为您的主机进行调整。要在重新启动后保持该值，可以更新/etc/sysctl.conf文件，如设置inHybrid推荐操作系统参数中所述。</p>
</div>

    </div>

  </div>

  <div class="related-links">
<div class="familylinks">
<div class="parentlink">
<strong>Parent topic:</strong> <a class="link" href="install_guide.html" title="Information about installing, configuring, and upgrading inHybrid Database software and configuring inHybrid Database host machines.">安装和升级inHybrid</a>
</div>
</div>
</div>
<div class="topic nested1" xml:lang="en" lang="en" id="topic16">
    <h2 class="title topictitle2">使用iptables规则的例子</h2>

    <div class="body">
      <p class="p">当启用iptables时，iptables根据配置设置(规则)管理主机系统上的IP通信。示例规则用于为inHybrid数据库master主机、standby主机和segment主机配置iptables。</p>

      <ul class="ul" id="topic16__ul_ckk_knz_thb">
        <li class="li" id="topic16__ji163179">
          示例master和standby主机iptables规则
        </li>

        <li class="li" id="topic16__ji163183">
          <a class="xref" href="enable_iptables.html#topic18">示例segment主机iptables规则</a>
        </li>

      </ul>

      <p class="p">这两组规则解释了inHybrid数据库在Master主机(primary和standby)和segment主机上期望的不同类型的通信。这些规则应该添加到inHybrid数据库主机的/etc/sysconfig/iptables文件中。对于inHybrid数据库，iptables规则应该允许以下通信:</p>

      <ul class="ul" id="topic16__ul_dkk_knz_thb">
        <li class="li" id="topic16__ji163197">对于面向客户的与inHybrid数据库管理员的通信，至少允许使用postgres和28080(示例中的eth1接口)。</li>

        <li class="li" id="topic16__ji163201">对于inHybrid数据库系统互连，允许使用tcp、udp和icmp协议进行通信(本例中是eth4和eth5接口)。
    <p class="p">在iptables设置中指定的网络接口是在hostfile_hdbinitsystem文件中列出的inHybrid数据库主机的接口。在运行hdbinitsystem命令初始化inHybrid数据库系统时指定该文件。有关hostfile_hdbinitsystem文件和hdbinitsystem命令的信息，请参阅初始化inHybrid数据库系统。</p>
</li>

        <li class="li" id="topic16__ji163212">对于inHybrid DCA上的管理网络，允许使用ssh、ntp和icmp协议进行通信。(例子中的eth0接口)。</li>

      </ul>

      <p class="p">在iptables文件中，每个追加规则命令(以-A开头的行)只有一行。</p>

      <p class="p">示例规则应该根据您的配置进行调整。例如:</p>

      <ul class="ul" id="topic16__ul_ekk_knz_thb">
        <li class="li" id="topic16__ji163215">append命令、-A行和连接参数-i应该匹配主机的连接器。</li>

        <li class="li" id="topic16__ji163216">源参数-s的CIDR网络掩码信息应该与您的网络的IP地址匹配。</li>

      </ul>

    </div>

    <div class="topic nested2" xml:lang="en" lang="en" id="topic17">
      <h3 class="title topictitle3">Master和Standby master使用iptables规则示例</h3>

      <div class="body">
        <p class="p">示例iptables规则，其中注释了inHybrid数据库master主机和standby master主机上的/etc/sysconfig/iptables文件。</p>

        <pre class="pre codeblock">*filter
# Following 3 are default rules. If the packet passes through
# the rule set it gets these rule.
# Drop all inbound packets by default.
# Drop all forwarded (routed) packets.
# Let anything outbound go through.
:INPUT DROP [0:0]
:FORWARD DROP [0:0]
:OUTPUT ACCEPT [0:0]
# Accept anything on the loopback interface.
-A INPUT -i lo -j ACCEPT
# If a connection has already been established allow the
# remote host packets for the connection to pass through.
-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
# These rules let all tcp and udp through on the standard
# interconnect IP addresses and on the interconnect interfaces.
# NOTE: gpsyncmaster uses random tcp ports in the range 1025 to 65535
# and inHybrid Database uses random udp ports in the range 1025 to 65535.
-A INPUT -i eth4 -p udp -s 192.0.2.0/22 -j ACCEPT
-A INPUT -i eth5 -p udp -s 198.51.100.0/22 -j ACCEPT
-A INPUT -i eth4 -p tcp -s 192.0.2.0/22 -j ACCEPT --syn -m state --state NEW
-A INPUT -i eth5 -p tcp -s 198.51.100.0/22 -j ACCEPT --syn -m state --state NEW<span class="ph">
# Allow udp/tcp ntp connections on the admin network on inHybrid DCA.
-A INPUT -i eth0 -p udp --dport ntp -s 203.0.113.0/21 -j ACCEPT
-A INPUT -i eth0 -p tcp --dport ntp -s 203.0.113.0/21 -j ACCEPT --syn -m state --state NEW</span>
# Allow ssh on all networks (This rule can be more strict).
-A INPUT -p tcp --dport ssh -j ACCEPT --syn -m state --state NEW
# Allow inHybrid Database on all networks.
-A INPUT -p tcp --dport postgres -j ACCEPT --syn -m state --state NEW
# Allow inHybrid Command Center on the customer facing network.
-A INPUT -i eth1 -p tcp --dport 28080 -j ACCEPT --syn -m state --state NEW
# Allow ping and any other icmp traffic on the interconnect networks.
-A INPUT -i eth4 -p icmp -s 192.0.2.0/22 -j ACCEPT
-A INPUT -i eth5 -p icmp -s 198.51.100.0/22 -j ACCEPT<span class="ph">
# Allow ping only on the admin network on inHybrid DCA.
-A INPUT -i eth0 -p icmp --icmp-type echo-request -s 203.0.113.0/21 -j ACCEPT</span>
# Log an error if a packet passes through the rules to the default
# INPUT rule (a DROP).
-A INPUT -m limit --limit 5/min -j LOG --log-prefix "iptables denied: " --log-level 7
COMMIT</pre>

      </div>

    </div>

    <div class="topic nested2" xml:lang="en" lang="en" id="topic18">
      <h3 class="title topictitle3">Segment主机使用iptables规则示例</h3>

      <div class="body">
        <p class="p">示例iptables规则用于inHybrid数据库segment主机上的/etc/sysconfig/iptables文件。Segment主机的规则类似于主规则，具有更少的接口和更少的udp和tcp服务。 </p>

        <pre class="pre codeblock">*filter
:INPUT DROP
:FORWARD DROP
:OUTPUT ACCEPT
-A INPUT -i lo -j ACCEPT
-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT
-A INPUT -i eth2 -p udp -s 192.0.2.0/22 -j ACCEPT
-A INPUT -i eth3 -p udp -s 198.51.100.0/22 -j ACCEPT
-A INPUT -i eth2 -p tcp -s 192.0.2.0/22 -j ACCEPT --syn -m state --state NEW
-A INPUT -i eth3 -p tcp -s 198.51.100.0/22 -j ACCEPT --syn -m state --state NEW
-A INPUT -p tcp --dport ssh -j ACCEPT --syn -m state --state NEW
-A INPUT -i eth2 -p icmp -s 192.0.2.0/22 -j ACCEPT
-A INPUT -i eth3 -p icmp -s 198.51.100.0/22 -j ACCEPT
-A INPUT -i eth0 -p icmp --icmp-type echo-request -s 203.0.113.0/21 -j ACCEPT
-A INPUT -m limit --limit 5/min -j LOG --log-prefix "iptables denied: " --log-level 7
COMMIT</pre>

      </div>

    </div>

  </div>



        

      </main>
    </div>
  </div>
</div>

<div id="scrim"></div>

<div class="container">
  <footer class="site-footer-links">
    
  </footer>
</div><!--end of container-->

</body>
</html>
